<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Google Pay Example</title>
  <style>
    #log, #isRTPrequest, #result {
      white-space: pre;
      font-family: monospace;
    }

    .padding-after {
      padding-bottom: 10px;
    }

    ul.no-bullets {
      list-style-type: none; /* Remove bullets */
      padding: 0; /* Remove padding */
      margin: 0; /* Remove margins */
    }

    .thirdPartyCookiesDisabled {
      color: white;
      background-color: #EE0000;
      padding: 3px;
    }

    .thirdPartyCookiesEnabled {
      color: white;
      background-color: green;
      padding: 3px;
    }

    /*
    .gpay-border-radius {
      border-radius: 7px !important;
      height: 40px;
    }
     */

  </style>
</head>

<body onload="cookieTest('https://bunpay.app/3pc/index.html')">
<div id="createButtonApiLabel" class="padding-after"><b>createButton() API variations:</b></div>
<div id="info" class="padding-after"><small>Note: in this demo the buttons are always
  displayed.<br/>No
  matter what the outcome of isReadyToPay is.<br/>If a payment method is not available,<br/>a
  generic "Buy with GPay" button is shown.</small></div>

<div id="3pc-support" class="padding-after">
  <small>3rd party cookies enabled: <span id="3pc" class="thirdPartyCookiesDisabled">false</span></small>
</div>


<div id="allPaymentMethodsInfo"><small>All payment methods</small></div>
<div id="container" class="padding-after"></div>

<div id="amexInfo"><small>Amex only</small></div>
<div id="container2" class="padding-after"></div>

<div id="masterCardInfo"><small>Mastercard only</small></div>
<div id="container3" class="padding-after"></div>

<div id="visaInfo"><small>Visa only</small></div>
<div id="container4" class="padding-after"></div>


<!--
<div id="buttonShapeLabel"><b>Button shape:</b></div>
<div id="shapeInfo" class="padding-after"><small>This is a hack and not officially
  supported!</small></div>
<div id="buttonShape" class="padding-after">
  <input type="radio" name="buttonShape" value="pill" checked="checked"/> pill
  <input type="radio" name="buttonShape" value="rectangular"/> rectangular
</div>
-->
<div id="buttonColorLabel" class="padding-after"><b>Button color:</b></div>
<div class="padding-after">
  <select name="buttonColors" id="buttonColors">
    <option value="default" selected="selected">default</option>
    <option value="black">black</option>
    <option value="white">white</option>
  </select>
</div>

<div id="buttonTypeLabel" class="padding-after"><b>Button type:</b></div>
<div class="padding-after">
  <select name="buttonTypes" id="buttonTypes">
    <option value="buy" selected="selected">buy</option>
    <option value="book">book</option>
    <option value="checkout">checkout</option>
    <option value="donate">donate</option>
    <option value="order">order</option>
    <option value="pay">pay</option>
    <option value="plain">plain</option>
    <option value="subscribe">subscribe</option>
  </select>
</div>

<div id="environmentLabel" class="padding-after"><b>Environment:</b></div>
<div class="padding-after">
  <select name="environments" id="environments">
    <option value="TEST" selected="selected">TEST</option>
    <option value="PRODUCTION">PRODUCTION</option>
  </select>
</div>

<div id="gatewayLabel" class="padding-after"><b>Gateway:</b></div>
<div class="padding-after">
  <select name="gateways" id="gateways">
    <option value="adyen">adyen</option>
    <option value="ariane" selected="selected">ariane</option>
    <option value="arianev2">arianev2</option>
    <option value="braintree">braintree</option>
    <option value="checkoutltd">checkoutltd</option>
    <option value="cybersource">cybersource</option>
    <option value="example">example</option>
    <option value="stripe">stripe</option>
    <option value="worldpay">worldpay</option>
  </select>
</div>

<div id="allowedAuthMethodsLabel" class="padding-after"><b>allowedAuthMethods:</b></div>
<div id="allowedAuthMethods" class="padding-after">
  <ul class="no-bullets">
    <li><input type="radio" name="allowedAuthMethods" value="PAN_ONLY"/> PAN_ONLY</li>
    <li><input type="radio" name="allowedAuthMethods" value="CRYPTOGRAM_3DS"/> CRYPTOGRAM_3DS</li>
    <li><input type="radio" name="allowedAuthMethods" value="PAN_ONLY_CRYPTOGRAM_3DS"
               checked="checked"/> PAN_ONLY, CRYPTOGRAM_3DS
    </li>
  </ul>
</div>

<div id="existingPaymentMethodRequireLabel" class="padding-after">
  <b>existingPaymentMethodRequired:</b></div>
<div id="existingPaymentMethodRequired" class="padding-after">
  <input type="radio" name="existingPaymentMethodRequired" value="true"/> true
  <input type="radio" name="existingPaymentMethodRequired" value="false" checked="checked"/> false
</div>
<div id="isRTPrequestLabel" class="padding-after"><b>isReadyToPay request payload:</b></div>
<div id="isRTPrequest" class="padding-after"></div>
<div id="isRTP" class="padding-after"><b>isReadyToPay API response:</b></div>
<div id="log" class="padding-after"></div>
<div id="resultLabel" class="padding-after"><b>paymentData response:</b></div>
<div id="result"></div>


</body>

<script src="main.js"></script>

<script>
  const cookieTest = (iFrameUri) => {

  let messageHandler = (event) => {
      // check for trusted origins here         
      const data = JSON.parse(event.data)
      console.log("3PC result: " + data['result']);      

      if(data['result'] && data['result'] == true) {
        let element = document.getElementById("3pc");
        element.classList.remove("thirdPartyCookiesDisabled");
        element.classList.add("thirdPartyCookiesEnabled");
        element.innerText = 'true';

        window.removeEventListener('message', messageHandler);
        document.body.removeChild(frame)
      }      

  }
  window.addEventListener('message', messageHandler);
  const frame = document.createElement('iframe')
  frame.src = iFrameUri
  frame.sandbox = "allow-scripts allow-same-origin"
  frame.style = `display:none`
  frame.onload = (e) => {
      frame.contentWindow.postMessage(JSON.stringify({ 'test': 'cookie' }), '*');
  }
  document.body.appendChild(frame)
  }
</script>

<script async
        src="https://pay.google.com/gp/p/js/pay.js" onload="onGooglePayLoaded()"></script>
</html>

